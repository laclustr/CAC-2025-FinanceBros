---
export const prerender = false;

import { hasOnboarded } from '@/lib/auth/hasOnboarded.ts';
import Layout from '@/layouts/DashboardLayout.astro';
import DashboardNav from '@/components/DashboardComps/DashboardNav.astro';
import RecentTransactions from '@/components/DashboardComps/RecentTransactions.astro';
import PieChart from '@/components/DashboardComps/PieChart.tsx';
import Header from '@/components/DashboardComps/Header.astro';

const { cookies, redirect } = Astro;
const token = cookies.get('token')?.value;

const [user, onboarded] = await hasOnboarded(token);

if (!user) {
  return redirect('/login/sign-in');
}
if (!onboarded) {
  return redirect('/login/onboarding');
}
---

<Layout>
  <Header />
  <div class="pt-4 px-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    <RecentTransactions title="Purchases"/>
    <PieChart client:load />
  </div>

  <DashboardNav />
</Layout>